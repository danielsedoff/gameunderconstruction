<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta charset="utf-8" />
    <title>Game Under Construction</title>
    <style>
      body {
        background-color: #333333;
        color: #ffffff;
        font-size: 2em;
      }
    </style>
  </head>
  <body>
    <table id="bigtable"></table>
    <script type="text/javascript">
      var bigtable = document.getElementById("bigtable");
      var fieldWidth = 9;
      var fieldHeight = 7;

      bigtable.innerHTML = drawEmptyTable(fieldWidth, fieldHeight);

      // The hero position is a global thing.
      document.heroPosition = [1, 0];
      // The first step does not have a real old position, so:
      heroWalks(-1, 0);

      // Draw a level 1 stone. It is not walkable.
      drawTileAt("s_1", 3, 3);

      // Draw a level 1 monster. It can not be killed.
      drawTileAt("m_1", 4, 4)

      // Basic Hero Walking method
      function heroWalks(xChange, yChange) {
        let x = document.heroPosition[0];
        let y = document.heroPosition[1];
        let oldTileId = `x_${x}_y_${y}`;
        console.log("oldTileId:" + oldTileId);

        x = x + xChange;
        y = y + yChange;
        if (x < 0 || y < 0 || y >= fieldHeight || x >= fieldWidth) {
          console.log("Out of game field.");
          return;
        }
        let newTileId = `x_${x}_y_${y}`;

        // Check if the new tile actually has ... inside
        newTileContent = document
          .getElementById(newTileId)
          .innerHTML.split("_");
        if (newTileContent[0] == "s") {
          console.log("Can't go to a non-empty tile.");
          return;
        } else if (newTileContent[0] == "g") {
          // Ground. You can walk ground.
          document.getElementById(oldTileId).innerHTML =
            newTileContent.join("_");
          document.getElementById(newTileId).innerHTML = "_H_";
        } else if (newTileContent[0] == "m") {
          // Monster. Now a monster can not be killed.
          // The level is now hardcoded to be 1.
          console.log("Stepped on a monster");
          document.getElementById(oldTileId).innerHTML = "g_1";
          document.heroPosition = [-2, -2];
          return;
        } else {
          console.log("Stepped on an unknown tile.");
        }
        document.heroPosition = [x, y];
      }

      // Enable Arrow Keys. Global event.
      document.onkeydown = checkKey;
      function checkKey(e) {
        e = e || window.event;

        if (e.keyCode == "38") {
          heroWalks(0, -1); // up arrow
        } else if (e.keyCode == "40") {
          heroWalks(0, 1); // down arrow
        } else if (e.keyCode == "37") {
          heroWalks(-1, 0); // left arrow
        } else if (e.keyCode == "39") {
          heroWalks(1, 0); // right arrow
        }
      }

      // Draw an empty table with divs whose ids are like x_2_y_5
      function drawEmptyTable(cols, rows) {
        var result = "";
        for (y = 0; y < rows; y++) {
          result += "<tr>";
          for (x = 0; x < cols; x++) {
            result += `<td><div id="x_${x}_y_${y}">g_1</div></td>`;
          }
          result += "</tr>";
        }
        return result;
      }

      function drawTileAt(tileContent, x, y) {
        id = `x_${x}_y_${y}`;
        document.getElementById(id).innerHTML = tileContent;
      }
    </script>
  </body>
</html>
